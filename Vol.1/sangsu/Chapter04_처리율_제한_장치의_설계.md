처리율 제한 장치를 만들어보기

- 사용자는 초당 2회 이상 새 글을 올릴 수 없다.
- 같은 IP 주소로는 하루에 10개 이상의 계정을 생성할 수 없다.
- 같은 디바이스로는 주당 5회 이상 리워드를 요청할 수 없다.

## 기본 사례를 갖고 처리율 제한 장치를 설계해보기

**1단계 문제 이해 및 설계 범위 확정**

⇒서버측 API를 위한 장치 설계

- 대규모 요청을 처리할 수 있어야 한다
- 분산환경 동작

⇒ API 게이트웨이 미들웨어를 별도 생성

## 처리율 제한 알고리즘

- 토큰 버킷 - 버킷에 토큰을 주기적으로 담는 형태
    - 장점 : 구현이 쉽다, 메모리 효율적, 짧은 시간 집중 트래픽 처리 가능
    - 단점 : 버킷 크기와 토큰 공급률이라는 두 인자를 적절하게 튜닝하는 것이 까다로움
- 누출 버킷
    - 토큰 버킷과 비슷하지만, 요청 처리율이 고정 - FIFO큐로 구현됨
    - 이 방식도 단시간에 많은 요청이 들어오면 최신 요청은 버려지게 된다
- 고정 윈도 카운터
    - 타임라인을 고정된 간격의 윈도로 나누고, 각 윈도마다 카운터를 붙인다
    - 고정된 간격의 윈도이기에 윈도의 경계 부근에 집중될 때 할당된 양보다 많이 들어올 수 있다
- 이동 윈도 로깅 알고리즘
    - 고정 윈도 카운터의 단점 해결
    - 요청의 타임스탬프를 추적, 레디스의 정렬 집합
    - 이건 이해가 잘 안가는데 뭘까..
- 이동 윈도 카운터
    - 고정 윈도 카운터 + 이동 윈도 로깅 알고리즘을 결합
    

처리율 제한 알고리즘의 기본 아이디어는 얼마나 많은 요청이 접수되었는지를 추적할 수 있는 카운터를 추적 대상별로 둔다

## 상세 설계

### 처리율 한도 초과 트래픽의 처리

한도 제한이 걸리면 두 선택지가 있을 것이다.

- 받은 요청을 버리기
- 나중에 처리하기 위한 별도의 큐에 보관하기(메시지 큐)
