**요구사항**

- 푸시 알림, SMS, E-Mail
- soft 실시간 시스템
- IOS, Android, Laptop, desktop 기기 지원
- 클라이언트 앱 and 서버 측에서 가능
- 알림 수신여부 확인
- 모바일 푸시 : 1000만 | SMS :  100만 | E-Mail : 500만

### 개략적 설계안

- 알림 유형별 지원 방안
- 연락처 정보 수집 절차
- 알림 전송 및 수신 절차

**IOS 푸시**

알림 제공자 → 알림 서비스(APNS) → IOS 단말

provider : 알림 요청을 만들 주체

**APNS(Apple Push Notification Service) : 애플 푸시 알림 서비스** 푸시 알림을 IOS 장치로 보내는 역할

- 단말 토큰(device token) : 알림 요청을 보내는 데 필요한 고유 식별자
- 페이로드(payload) : 알림 내용을 담은 JSON 딕셔너리(dictionary)

**Android 푸시**

알림 제공자 → FCM(Firebase Cloud Messaging) → 안드로이드 단말

**SMS 메시지**

알림 제공자 → SMS 서비스 → SMS 수신 단말

sms 서비스 트윌리오(Twilio), 넥스모(Nexmo) 등 제 3 사업자

**E-Mail**

알림 제공자 → 이메일 서비스 → 이메일 수신 단말

고유 이메일 서버 or 상용 이메일 서비스 센드그리드(Sendgrid), 메일침프(Mailchimp)등

이 네 모듈을 한 시스템으로 묶어서 처리

앱을 설치 후 계정 등록 시 해당 사용자의 정보를 수집해둬야 한다.

마이크로 서비스 or 크론 잡 or 분산 컴포넌트 등으로 구현

따라서 n개의 서비스에서 알림 시스템으로 보내면 각 IOS, Android, SMS, Email 등의 Payload에 맞춰서 데이터가 가공되어 변경되어야 함

알림 서버를 하나로 둔다면, SPOF 문제가 필히 발생할 것

알림 서버에서 캐싱, 데이터베이스를 둔다.

따라서 알림 서버를 마스터 서비스로 두고, 각 처리 서버별로 모듈화하여, 사용한다면 효율적인 그림이 그려질 것

1. API를 호출해 알림 서버로 알림을 보낸다
2. 알림 서버는 사용자 정보, 단말 토큰, 알림 설정 같은 메타데이터를 캐시나 데이터베이스에서 가져온다
3. 알림 서버는 전송할 알림에 맞는 이벤트를 만들어서 해당 이벤트를 위한 큐에 넣는다
4. 작업 서버는 메시지 큐에서 알림 이벤트를 꺼낸다
5. 작업 서버는 알림을 제3자 서비스로 보낸다
6. 제3자 서비스는 사용자 단말로 알림을 전송한다

추가 고려사항

- 안정성
 분산 환경에서 알림 시스템을 설계할 때는 안정성을 확보하기 위해 반드시 고려해야할 점이  존재
    - 데이터 손실 방지
    알림 시스템은 지연되거나 순서가 틀려도 괜찮지만 사라지면 안된다. 따라서 DB에 해당 로그 저장
    - 알림 중복 전송 방지
    분산 시스템 특성상 가끔은 알림이 중복되어 처리될 것인데, 이를 방지하기 위한 중복 방지 로직을 설정해야 함
    ⇒ 해시형식의 캐시
    - 추가 고려사항
        - 알림 템플릿
        - 알림 수신여부 설정
        - 전송률 제한
        - 재시도 방법
        - 푸시 알림과 보안
        - 큐 모니터링
        - 이벤트 추적


<img width="1047" height="620" alt="image" src="https://github.com/user-attachments/assets/f7db5e31-ccf0-4bc6-af38-55738ab14dc4" />
